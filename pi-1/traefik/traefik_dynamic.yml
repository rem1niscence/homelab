# If you're using tailscale domain, subdomains won't work
# TODO: Split traefik into two for tailscale and custom domain
http:
  routers:
    traefik:
      rule: Host(`traefik.{{ env "DOMAIN" }}`)
      service: "api@internal"
      middlewares:
        - simple-auth
    homarr:
      rule: Host(`{{ env "DOMAIN" }}`)
      service: homarr
    portainer:
      rule: Host(`portainer.{{ env "DOMAIN" }}`)
      service: portainer
    grafana:
      rule: Host(`grafana.{{ env "DOMAIN" }}`)
      service: grafana
    pihole:
      rule: Host(`pihole.{{ env "DOMAIN" }}`)
      service: pihole
    jellyfin:
      rule: Host(`jellyfin.{{ env "DOMAIN" }}`)
      service: jellyfin
    jellyseerr:
      rule: Host(`jellyseerr.{{ env "DOMAIN" }}`)
      service: jellyseerr
    umami:
      rule: Host(`analytics.{{ env "DOMAIN" }}`)
      service: umami
    uptime-kuma:
      rule: Host(`uptime.{{ env "DOMAIN" }}`)
      service: uptime-kuma
    dashdot:
      rule: Host(`dashdot.{{ env "DOMAIN" }}`)
      service: dashdot
    # homar is hitting the wrong endpoints of dashdot
    dashdot-api:
      rule: PathPrefix(`/api/modules/dashdot`)
      service: dashdot
      middlewares:
        - strip-prefix
      tls:
        certResolver: tsresolver
    # --- !Dashdot ------

  services:
    portainer:
      loadBalancer:
        servers:
          - url: "http://portainer:9000"
    grafana:
      loadBalancer:
        servers:
          - url: "http://grafana:3000"
    pihole:
      loadBalancer:
        servers:
          - url: "http://pihole:80"
    umami:
      loadBalancer:
        servers:
          - url: "http://umami:3000"    
    jellyfin:
      loadBalancer:
        servers:
          - url: "http://jellyfin:8096"
    jellyseerr:
      loadBalancer:
        servers:
          - url: "http://jellyseerr:5055"
    homarr:
      loadBalancer:
        servers:
          - url: "http://homarr:7575"
    dashdot:
      loadBalancer:
        servers:
          - url: "http://dashdot:3001"
    sonarr:
      loadBalancer:
        servers:
          - url: "http://sonarr:8989"    
    radarr:
      loadBalancer:
        servers:
          - url: "http://radarr:7878"    
    prowlarr:
      loadBalancer:
        servers:
          - url: "http://prowlarr:9696"
    uptime-kuma:
      loadBalancer:
        servers:
          - url: "http://uptime-kuma:3001"  

  middlewares:
    strip-prefix:
      stripPrefix:
        prefixes:
          - /api/modules/dashdot
    dashdot-storage-path-replace:
      replacePath:
        path: "/load/storage"
    simple-auth:
      basicAuth:
        users:
          - "pi-admin:$apr1$pAYi7oll$NQR6hcTYFfIqBpnzpPBL91"
