version: '3'

services:
  traefik:
    image: traefik:v3.0
    container_name: traefik
    ports:
      - "443:443"
      - "443:443/udp"      
      - "80:80"
    environment:
      - ACME_DNS_API_BASE=https://auth.acme-dns.io
      - ACME_DNS_STORAGE_PATH=/acme-dns
    volumes:
      # So that Traefik can listen to the Docker events
      - /var/run/docker.sock:/var/run/docker.sock
      - ./traefik.yml:/traefik.yml
      - ./traefik_dynamic.yml:/traefik_dynamic.yml
      # If you want to use tailscale magic DNS
      # - ../tailscale/tailscaled.sock:/var/run/tailscale/tailscaled.sock
      - ./acme/acme.json:/acme.json
      - ./acme/acme-dns:/acme-dns 
    networks:
     - pi-network
    env_file:
      - .env
    extra_hosts:
      - "host.docker.internal:host-gateway"

networks:
  pi-network:
    external: true